# ボット作成チャレンジ 上級

## Hack your own way
このチャレンジはボット作成チャレンジの中級を受けていることが前提です。

さあ、基本問題で簡単なチャットボットを実装できたあなたには、こちらの応用問題に挑戦していただきます。 
オリジナルのチャットボットの実装です。  
以下の問題文をよく読み、自分自身のオリジナルのチャットボットを完成させましょう。

## 基本仕様
ここで作成するチャットボットの基本仕様は以下です。

- チャットボットとの通信はWebSocket(wsプロトコル)で行う
  - wssで通信できても良いが、テストで使用するのはwsのみ
- チャットボットへの送信は平文の文字列
- チャットボットに対するコマンドは"bot "で始まる平文で以降はコマンド文字列の羅列とする
- チャットボットからのレスポンスはすべてJSON形式で、`data`というキーにレスポンスの文字列を持つ
  - data以外の任意のキーをレスポンスに含めることは自由
- チャットボットへの送信内容はコマンドも含めすべて接続されている全ユーザーに対してエコーされる


## Step 1：チャットアプリを設置するサーバーや、利用するサービスを決めよう！
まずは自分のボットサーバーを設置するためのサービスを決めましょう。  

Deploy先のサーバはHeroku, EngineYard, AWS, Azure等何でも構いません。  

サービスが決まってデプロイできればアクセスするための URL も決まると思います。  
デプロイ先のホスト名およびエンドポイントのパスを[app/config/account.json](app/config/account.json)に記述してください。  
以降のテストではこのURLにアクセスして実装の検証が行われます。

また、レビュアーの人たちが好きなときにサービスを見れるように、[answer.md](answer.md) に決まった URL を書いておきましょう！


## Step 2： 必須機能の実装
このステップでは、デプロイしたサーバーが正しく動作しているかどうかを検証するために二つの機能(コマンドとしては4つ)を実装してもらいます。

### A. ステータスチェックコマンド、`bot ping` の実装
botに対して`bot ping`というコマンドを送信した際に`pong`を返すコマンドを実装してください。
レスポンスはJSON形式で以下のようになります。

```
{
  "data": "pong"
}
```

このコマンドに対するテストの実装は

- [tests/ping.spec.js](tests/ping.spec.js)

にあります。

### B. ToDoの登録・削除・一覧
ToDoを管理する`bot todo add`, `bot todo delete`, `bot todo list`という３つのコマンドを実装してください。

- `bot todo add`
  - このコマンドは引数を二つ以上取ります。
  - 引数の１つ目はToDoの名前、二つ目以降はその内容を表す任意の文字列です。
  - 成功した場合、`todo added`というメッセージを返します。
```json
{
  "data": "todo added"
}
```

- `bot todo delete`
  - このコマンドは引数を一つ取ります。
  - 引数はaddコマンドで登録したToDo名です。
  - 成功した場合は`todo deleted`というメッセージを返します。
```json
{
  "data": "todo deleted"
}
```

- `bot todo list`
  - このコマンドは引数を必要としません。
  - 成功した場合はすべてのToDoを改行区切りで連結した文字列を返します。
  - 1 つも ToDo が存在しなかった場合は `todo empty` を返します。
```json
{
  "data": "todo1 implement ping\ntodo2 implement todo add\ntodo3 implement todo delete\todo4 implement todo list"
}
```

これらのコマンドに対するテストの実装は

- [tests/todo.spec.js](tests/todo.spec.js)

にあります。

#### ※1  
ToDoの実装のためにはなんらかのストレージが必要になります。RDB, KeyValueストア等任意のストレージを利用して構いません。

#### ※2
テストが正しく実行されるには `todo list` と `todo delete` のコマンドが実装されている必要があります。

#### ※3
このToDo機能はあくまで自動テストのためのリファレンス実装です。  
テストの実行によって、登録したToDoが削除されることが発生し得ることに注意してください。


## Step 3: 独自コマンドの実装
次のステップとして自分独自のコマンドを実装してみましょう！  
実装するコマンドは

- チャットボットに対するコマンドは"bot "で始まる平文で以降はコマンド文字列の羅列とする
- チャットボットからのレスポンスはすべてJSON形式で、`data`というキーにレスポンスの文字列を持つ

という二つのルールを守っていればどのようなコマンドでも構いません。  
また、世の中に存在するあらゆるWebサービスを利用することも自由です。

例として以下のようなコマンドが考えられます。

- 現在のお天気を返す`bot weather`コマンド
  - コマンドは日本語でも構わないので`bot 天気`というコマンドでもOKです。
- `bot exchange dollar 1`のように引数のドル、または円の為替変換を行うコマンド
- `bot jojo`でジョジョの名言をランダムで返すコマンド
- `bot help`でコマンドの一覧が返ってきてくれると多分レビュアーの人たちは嬉しい

最低一つの独自コマンドを実装してみてください。
審査員をうならせるような独創性のあるコマンドの実装を期待しています！

### 独自コマンドのテストについて
独自コマンドを実装している過程では、独自のテストを追加したくなるかもしれません。  
その場合は「tests」以外のフォルダを作成して、そこに自分の好きなテストフレームワークを使用して実装してください。

testsフォルダのテストはcodecheckが自動テストのために使用するものであり、テストの実行もインターネット上のサーバに対して行っています。

通常このようなテストはローカル環境上で実行しているアプリケーションに対して行うことが一般的であり、特に外部ストレージを利用しているような場合codecheckのテストサーバ上で正しく動作するとは限りません。

※ テストの実装は必須ではありませんが、適切にテストが実装されているとレビュアーの印象は良くなるかもしれません。

## Extra 1: その他のボット機能拡張
以降のステップは必須ではありませんが、ボットの実装中にコマンド以外にも拡張したい機能がでてくるかもしれません。
その場合は自由に実装していただいて構いません。

例としては

- ユーザー認証機能の追加
  - 例えばGitHubなどのAPIを使用する場合はOAuth認証が有効です。
  - 今回のレギュレーションではSSLは必須ではないので単純な`bot login [USERNAME] [PASSWORD]`のような実装は避けたほうが無難です。
- コマンドのエイリアス登録機能
  - 長いコマンド名に対してユーザーが自分専用の別名を登録できると便利かもしれません。

など。  
無理にアイデアをひねり出す必要はありませんが、出題者の想定のナナメ上をいくような機能実装も歓迎です。

## Extra 2: ボットクライアントの実装
今回主催者側で簡易的な汎用クライアントを用意しますが、機能拡張の仕方によってはそれでは不足があるかもしれません。

例えば以下のようにレスポンスにusernameを加えるような拡張をしたとしても汎用クライアントはusernameを拾いません。

``` json
{
  "username": "user1",
  "data": "some response"
}
```

アイデアの実現のために必要であれば、独自のクライアントを実装することも自由です。

#### ※
今回のコンテストはクライアントサイドを対象としたものではないので、見た目やデザインに必要以上にこだわる必要はありません。
自分の表現したい機能が示されていればUIは簡易的なものでも構いません。

## answer.mdについて
[answer.md](answer.md)には

- チャットボットをデプロイしたサーバーのURL
- 追加したコマンドの内容
- その他創意工夫した点

を自由に記述してください。

せっかく機能実装をしてもここでの説明が不足しているとレビュアーが機能に気づかないこともありえるので、できるだけ詳細に記述することをお勧めします。

## 問題についてのご意見

もし、解答中に問題に関しての不明点や、ご質問、改善案などがございましたら、
サービス上のお問い合わせチャット、または運営事務局(sprint@code-check.io)までお問い合わせください。
